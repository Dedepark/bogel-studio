<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bogel Studio - Galeri Foto Komunitas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        /* MODIFIKASI BESAR: Gaya Baru yang Lebih Dinamis */
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --accent-color: #e94560;
            --accent-hover: #ff4666;
            --text-primary: #f5f5f5;
            --text-secondary: #a8a8b3;
            --border-color: #2a2a4a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* Scrollbar custom */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-hover); }

        /* Header dengan efek glassmorphism */
        .header-fixed {
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }

        /* Sidebar dengan gradient */
        .sidebar {
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-right: 1px solid var(--border-color);
        }
        
        /* Tombol dengan gradient dan efek hover */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), #c23452);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.4);
        }

        /* Card foto dengan efek hover yang lebih halus */
        .photo-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        .photo-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-color);
        }
        .photo-card img {
            transition: transform 0.5s ease;
        }
        .photo-card:hover img {
            transform: scale(1.1);
        }

        /* Gaya untuk form input */
        .form-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }
        .form-input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.2);
        }

        /* Ikon Like dan Save yang baru */
        .icon-btn {
            transition: all 0.2s ease;
        }
        .icon-btn:hover {
            transform: scale(1.2);
        }
        .icon-btn.liked {
            color: var(--accent-color);
        }
        .icon-btn.saved {
            color: #fbbf24; /* Warna kuning untuk save/favorit */
        }

        /* MODIFIKASI BESAR: Gaya Modal YouTube Shorts */
        .shorts-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: black;
            z-index: 50;
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
        }
        .shorts-modal-overlay.show {
            display: flex;
        }
        .shorts-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 450px;
            max-height: 100vh; /* Full height on mobile */
            display: flex;
            flex-direction: column;
        }
        .shorts-image-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
        }
        .shorts-image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .shorts-overlay-top, .shorts-overlay-bottom {
            position: absolute;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
        }
        .shorts-overlay-bottom {
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        }
        .shorts-actions {
            position: absolute;
            bottom: 20%;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .shorts-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            cursor: pointer;
        }
        .shorts-action-btn svg {
            width: 32px;
            height: 32px;
        }
        .shorts-action-btn span {
            font-size: 12px;
            margin-top: 4px;
        }


        /* Gaya lainnya (dari kode asli, disesuaikan) */
        .content { flex-grow: 1; }
        @media (max-width: 767px) { .sidebar { position: fixed; top: 0; left: 0; height: 100vh; transform: translateX(-250px); z-index: 40; } .sidebar.open { transform: translateX(0); } .content { margin-left: 0; } .overlay { display: none; } .overlay.active { display: block; } }
        @media (min-width: 768px) { .sidebar { transform: translateX(0); } .content { margin-left: 250px; } .header-fixed { left: 250px; width: calc(100% - 250px); } }
        #photo-grid, #favorite-grid, #profile-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        #toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 100; display: flex; flex-direction: column; gap: 0.5rem; }
        .toast { background-color: var(--bg-secondary); color: var(--text-primary); padding: 0.75rem 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); opacity: 0; transform: translateY(-20px); transition: opacity 0.3s ease-out, transform 0.3s ease-out; border-left: 4px solid var(--accent-color); }
        .toast.show { opacity: 1; transform: translateY(0); } .toast.success { border-left-color: #10b981; } .toast.error { border-left-color: #ef4444; } .toast.info { border-left-color: #3b82f6; }
        #custom-confirm-overlay { background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); display: none; transition: opacity 0.3s ease; opacity: 0; }
        #custom-confirm-overlay.show { opacity: 1; }
        .nav-button.active-nav-link { background-color: var(--accent-color); color: white; }
        .filter-container { overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; -webkit-overflow-scrolling: touch; white-space: nowrap; padding-bottom: 4px; }
        .filter-container::-webkit-scrollbar { height: 6px; } .filter-container::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen">

    <!-- OVERLAY -->
    <div id="overlay" class="overlay fixed inset-0 bg-black opacity-50 z-30 hidden md:hidden" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR / NAVIGATION -->
    <div id="sidebar" class="sidebar fixed h-full z-40 p-4 border-r border-gray-700 flex flex-col justify-between">
        <div>
            <div class="text-2xl font-bold mb-8 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Bogel Studio</div>
            
            <nav class="space-y-2">
                <button onclick="changePage('home')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150 active-nav-link" data-page="home">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mr-3 w-5 h-5"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                    <span>Beranda</span>
                </button>
                <button onclick="changePage('history')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="history">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history mr-3 w-5 h-5"><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 15.7 6.4c.64.92 1 2.05 1 3.1c0 .35-.04.69-.1.97"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-15.7-6.4c-.64-.92-1-2.05-1-3.1c0-.35.04-.69.1-.97"/><path d="M12 7v5l3 3"/></svg>
                    <span>Riwayat</span>
                </button>
                <button onclick="changePage('favorites')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="favorites">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark mr-3 w-5 h-5"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
                    <span>Favorit</span>
                </button>
                <button onclick="changePage('notifications')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150 relative" data-page="notifications">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell mr-3 w-5 h-5"><path d="M18.6 3.1c.1.3 0 .7-.2.9L12 18 5.6 3.1c-.2-.2-.3-.6-.2-.9.1-.3.3-.6.6-.7h12c.2 0 .5.3.6.7Z"/><path d="M21 18s-2-2-7-2-7 2-7 2"/></svg>
                    <span>Notifikasi</span>
                    <span id="notif-badge" class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full hidden">0</span>
                </button>
                <button onclick="changePage('developer')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="developer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code mr-3 w-5 h-5"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                    <span>Pengembang</span>
                </button>
                
                <!-- MODIFIKASI BESAR: Menu Auth & Profil -->
                <div id="auth-menu" class="space-y-2 border-t border-gray-700 pt-4 mt-4">
                    <!-- Menu ini akan diisi oleh JavaScript -->
                </div>
            </nav>
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <div id="main-content" class="content min-h-screen pt-4 pb-12 transition-all duration-300">
        <!-- Header (tetap) -->
        <header class="header-fixed fixed top-0 w-full z-20 p-4 transition-all duration-300">
            <div class="flex items-center justify-between md:justify-start max-w-7xl mx-auto">
                <button id="menu-button" onclick="toggleSidebar()" class="md:hidden p-2 rounded-lg text-white hover:bg-gray-700 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                </button>
                <div class="flex items-center w-full max-w-lg bg-[#161b22] rounded-xl border border-gray-700 p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search text-gray-400 mx-2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="search-input" placeholder="Cari foto, pengunggah, atau kata kunci..." class="w-full bg-transparent outline-none text-white placeholder-gray-500" oninput="handleSearch(this.value)">
                </div>
            </div>
        </header>

        <!-- PAGE CONTENT CONTAINER -->
        <div class="max-w-7xl mx-auto px-4 mt-20"> 
            
            <!-- HOME PAGE -->
            <section id="page-home" class="page-content">
                <h1 class="text-3xl font-bold mb-6 text-white">Jelajahi Galeri</h1>
                <div id="photo-grid" class="pb-12">
                    <!-- Foto akan dimuat di sini -->
                </div>
                 <div id="no-results" class="text-center py-10 hidden">
                    <p class="text-xl text-gray-500">Tidak ada hasil yang ditemukan.</p>
                </div>
            </section>

            <!-- HISTORY PAGE -->
            <section id="page-history" class="page-content hidden">
                <h1 class="text-3xl font-bold mb-6 text-white">Riwayat</h1>
                <div id="history-list" class="space-y-4">
                    <!-- Riwayat akan dimuat di sini -->
                </div>
                <div id="history-empty" class="text-center py-10 hidden">
                    <p class="text-xl text-gray-500">Anda belum melihat foto apa pun baru-baru ini.</p>
                </div>
            </section>

            <!-- FAVORITES PAGE -->
            <section id="page-favorites" class="page-content hidden">
                <h1 class="text-3xl font-bold mb-6 text-white">Foto Favoritmu</h1>
                <div id="favorite-grid" class="pb-12">
                    <!-- Foto favorit akan dimuat di sini -->
                </div>
                <div id="favorites-empty" class="text-center py-10 hidden">
                    <p class="text-xl text-gray-500">Kamu belum menambahkan foto ke favorit.</p>
                </div>
            </section>

            <!-- NOTIFICATIONS PAGE -->
            <section id="page-notifications" class="page-content hidden">
                <h1 class="text-3xl font-bold mb-6 text-white">Notifikasi Terbaru</h1>
                <div id="notifications-list" class="space-y-4">
                    <!-- Notifikasi akan dimuat di sini -->
                </div>
                <button onclick="clearNotifications()" class="mt-6 px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 transition">Hapus Semua Notifikasi</button>
            </section>

            <!-- DEVELOPER PAGE -->
            <section id="page-developer" class="page-content hidden">
                <h1 class="text-3xl font-bold mb-6 text-white">Tentang Pengembang</h1>
                <div class="bg-[#161b22] p-6 rounded-xl border border-gray-700 max-w-2xl">
                    <p class="text-lg mb-4 text-gray-300">Perkenalkan saya adalah reinkarnasi dari Albert Instant</p>
                    <p class="text-lg mb-4 text-gray-300">Saya menyadari adanya rasa sakit dari fenomena jatuh nya buah durian ke kepala saya</p>
                    <p class="text-lg mb-4 text-gray-300">Saya seorang mahasiswa di sebuah kampus, saya mengambil jurusan Informatika karna dari sejak sd saya suka dengan komputer, jadi ketika saya kuliah, harapan saya adalah dibelikan pc atau laptop yang akan saya gunakan untuk bermain game</p>
                  <p class="text-lg mb-4 text-gray-300">Tapi ternyata itu salah, saya memang bisa bermain game dengan nyaman dengan laptop, tapi tanggung jawab saya sebagai mahasiswa, adalah untuk belajar, jadi ya ketika saya stress, ketika saya galau, ketika saya gak mood, ketika saya ada waktu luang, saat itu lah saya bermain game, jadi siklus hidup saya cukup simpel hanya MAKAN-TIDUR-KULIAH-GAME</p>
                  <p class="text-lg mb-4 text-gray-300">Sekian dari saya Terima NasibðŸ˜­</p>
                    
                    <h2 class="text-xl font-semibold mb-4 text-white">Hubungi Saya</h2>
                    <div class="space-y-3">
                        <a href="https://www.tiktok.com/@zadostrix" target="_blank" class="flex items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-3 text-gray-400"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                            <span class="text-white">TikTok: @zadostrix</span>
                        </a>
                        <a href="https://www.instagram.com/dede260104/" target="_blank" class="flex items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-3 text-gray-400"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.405a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z"/></svg>
                            <span class="text-white">Instagram: @dede260104</span>
                        </a>
                        <a href="mailto:zadpropc@gmail.com" target="_blank" class="flex items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 text-gray-400"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                            <span class="text-white">Email: zadpropc@gmail.com</span>
                        </a>
                        <a href="https://www.youtube.com/@BIAK_GAMING" target="_blank" class="flex items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-3 text-gray-400"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                            <span class="text-white">YouTube: @BIAK_GAMING</span>
                        </a>
                    </div>
                </div>
            </section>

            <!-- MODIFIKASI BESAR: Halaman Login, Register, & Profil -->
            <section id="page-login" class="page-content hidden">
                <div class="max-w-md mx-auto mt-10">
                    <h2 class="text-3xl font-bold text-center mb-6">Masuk ke Akunmu</h2>
                    <form id="login-form" class="space-y-4">
                        <input type="email" id="login-email" placeholder="Email" required class="form-input w-full p-3 rounded-lg">
                        <input type="password" id="login-password" placeholder="Password" required class="form-input w-full p-3 rounded-lg">
                        <button type="submit" class="btn-primary w-full p-3 rounded-lg font-semibold">Masuk</button>
                    </form>
                    <p class="text-center mt-4 text-gray-400">Belum punya akun? <a href="#" onclick="changePage('register')" class="text-accent-color hover:underline">Daftar di sini</a>.</p>
                </div>
            </section>

            <section id="page-register" class="page-content hidden">
                <div class="max-w-md mx-auto mt-10">
                    <h2 class="text-3xl font-bold text-center mb-6">Buat Akun Baru</h2>
                    <form id="register-form" class="space-y-4">
                        <input type="text" id="register-username" placeholder="Username" required class="form-input w-full p-3 rounded-lg">
                        <input type="email" id="register-email" placeholder="Email" required class="form-input w-full p-3 rounded-lg">
                        <input type="password" id="register-password" placeholder="Password" required class="form-input w-full p-3 rounded-lg">
                        <button type="submit" class="btn-primary w-full p-3 rounded-lg font-semibold">Daftar</button>
                    </form>
                    <p class="text-center mt-4 text-gray-400">Periksa email anda jika sudah mencoba mendaftar, hanya untuk konfirmasi pendaftaran, atau jika anda sudah punya akun yang didaftarkan <a href="#" onclick="changePage('login')" class="text-accent-color hover:underline">Masuk di sini</a>.</p>
                </div>
            </section>

            <section id="page-profile" class="page-content hidden">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold mb-6">Profil Saya</h2>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mb-6">
                        <div class="flex items-center space-x-4">
                            <!-- PERBAIKAN: Placeholder avatar yang lebih andal -->
                            <img id="profile-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'/%3E%3C/svg%3E" alt="Avatar" class="w-20 h-20 rounded-full object-cover">
                            <div>
                                <h3 id="profile-username" class="text-xl font-semibold">Loading...</h3>
                                <p id="profile-email" class="text-gray-400">Loading...</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label for="avatar-upload" class="btn-primary inline-block p-2 rounded-lg cursor-pointer">Ganti Avatar</label>
                            <input type="file" id="avatar-upload" accept="image/*" class="hidden">
                        </div>
                    </div>

                    <h3 class="text-2xl font-bold mb-4">Unggah Foto Baru</h3>
                    <form id="upload-form" class="bg-gray-800 p-6 rounded-xl border border-gray-700 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Judul Foto</label>
                            <input type="text" id="upload-title" required class="form-input w-full p-3 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Deskripsi</label>
                            <textarea id="upload-description" rows="3" class="form-input w-full p-3 rounded-lg"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">Unggah dari Perangkat</label>
                            <input type="file" id="upload-file" accept="image/*" class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-accent-color file:text-white hover:file:bg-accent-hover">
                        </div>
                        <div class="relative">
                            <p class="text-center text-gray-500 my-2">atau</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-1">URL Gambar (Link)</label>
                            <input type="url" id="upload-url" placeholder="https://..." class="form-input w-full p-3 rounded-lg">
                        </div>
                        <button type="submit" class="btn-primary w-full p-3 rounded-lg font-semibold">Unggah Foto</button>
                    </form>

                    <h3 class="text-2xl font-bold mb-4 mt-8">Foto-Fotoku</h3>
                    <div id="profile-grid" class="pb-12">
                        <!-- Foto user akan dimuat di sini -->
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- MODIFIKASI BESAR: Modal YouTube Shorts -->
    <div id="photo-modal-overlay" class="shorts-modal-overlay">
        <div class="shorts-container">
            <!-- Close Button -->
            <button onclick="closePhotoModal()" class="absolute top-4 right-4 z-50 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
            
            <!-- Image -->
            <div class="shorts-image-container">
                <img id="modal-photo-img" src="" alt="Detail Foto" class="w-full h-full object-contain">
            </div>

            <!-- Top Overlay: User Info -->
            <div class="shorts-overlay-top">
                <div class="flex items-center space-x-3">
                    <!-- PERBAIKAN: Placeholder avatar yang lebih andal -->
                    <img id="modal-uploader-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'/%3E%3C/svg%3E" alt="Uploader" class="w-10 h-10 rounded-full">
                    <div>
                        <p id="modal-photo-uploader" class="text-white font-semibold"></p>
                        <p id="modal-photo-date" class="text-gray-300 text-sm"></p>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Overlay: Description -->
            <div class="shorts-overlay-bottom">
                <h2 id="modal-photo-title" class="text-white text-lg font-bold"></h2>
                <p id="modal-photo-description" class="text-gray-300 text-sm mt-1"></p>
            </div>
            
            <!-- Right Side Actions -->
            <div class="shorts-actions">
                <!-- Like Button -->
                <div id="modal-like-btn" class="shorts-action-btn">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"></path></svg>
                    <span id="modal-like-count">0</span>
                </div>
                <!-- Favorite Button -->
                <div id="modal-favorite-btn" class="shorts-action-btn">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast & Custom Confirm (tetap) -->
    <div id="toast-container"></div>
    <div id="custom-confirm-overlay" class="fixed inset-0 z-50 flex items-center justify-center">
        <div class="bg-gray-800 rounded-xl shadow-2xl p-6 w-11/12 max-w-sm border border-gray-700">
            <h3 id="confirm-title" class="text-xl font-bold text-white mb-4"></h3>
            <p id="confirm-message" class="text-gray-300 mb-6"></p>
            <div class="flex justify-end space-x-3">
                <button id="confirm-no" class="px-4 py-2 bg-gray-600 rounded-lg text-white hover:bg-gray-700 transition">Tidak</button>
                <button id="confirm-yes" class="px-4 py-2 bg-red-600 rounded-lg text-white font-semibold hover:bg-red-700 transition">Ya</button>
            </div>
        </div>
    </div>

    <script>
// ==================== MODIFIKASI BESAR: KODE JAVASCRIPT UTAMA ====================

// --- KONFIGURASI & GLOBAL VARIABLES ---
async function getConfig() {
    try {
        const response = await fetch('/.netlify/env');
        const env = await response.json();
        return { SUPABASE_URL: env.SUPABASE_URL, SUPABASE_ANON_KEY: env.SUPABASE_ANON_KEY };
    } catch (error) {
        console.error("Could not load Netlify env vars, falling back to hardcoded values.");
        return {
            SUPABASE_URL: "https://vqvdkrmrfbmvtcvdwjhr.supabase.co",
            SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxdmRrcm1yZmJtdnRjdmR3amhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MzIxMjcsImV4cCI6MjA3NTIwODEyN30.tFs_JsidS5H99PiBpIMYkI83aQXz6NTBYTlWL25ixcg"
        };
    }
}
let supabase;

// State global untuk user dan data
let user = null;
let photos = [];
let favorites = JSON.parse(localStorage.getItem('bogelstudio_favorites') || '[]');
let history = JSON.parse(localStorage.getItem('bogelstudio_history') || '[]');
let notifications = JSON.parse(localStorage.getItem('bogelstudio_notifications') || '[]');

// --- FUNGSI AUTENTIKASI (BARU) ---
async function signUp() {
    const username = document.getElementById('register-username').value;
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    
    const { data, error } = await supabase.auth.signUp({ email, password, options: { data: { full_name: username } } });
    if (error) return showToast(error.message, 'error');
    
    // Update username di tabel profiles
    const { error: profileError } = await supabase.from('profiles').update({ username }).eq('id', data.user.id);
    if (profileError) return showToast(profileError.message, 'error');

    showToast('Pendaftaran berhasil! Silakan cek email untuk verifikasi.', 'success');
    changePage('login');
}

async function signIn() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) return showToast(error.message, 'error');
    user = data.user;
    showToast('Login berhasil!', 'success');
    updateUIForAuthStatus();
    changePage('home');
}

async function signOut() {
    const { error } = await supabase.auth.signOut();
    if (error) return showToast(error.message, 'error');
    user = null;
    showToast('Anda telah logout.', 'info');
    updateUIForAuthStatus();
    changePage('home');
}

// --- FUNGSI UNTUK MEMPERBARUI UI BERDASARKAN STATUS LOGIN ---
function updateUIForAuthStatus() {
    const authMenu = document.getElementById('auth-menu');
    if (user) {
        authMenu.innerHTML = `
            <button onclick="changePage('profile')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="profile">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user mr-3 w-5 h-5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <span>Profil Saya</span>
            </button>
            <button onclick="signOut()" class="w-full flex items-center p-3 rounded-xl bg-red-600 hover:bg-red-700 transition duration-150 text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out mr-3 w-5 h-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>
                <span>Logout</span>
            </button>
        `;
    } else {
        authMenu.innerHTML = `
            <button onclick="changePage('login')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="login">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in mr-3 w-5 h-5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" x2="3" y1="12" y2="12"></line></svg>
                <span>Login</span>
            </button>
            <button onclick="changePage('register')" class="nav-button w-full flex items-center p-3 rounded-xl hover:bg-gray-700 transition duration-150" data-page="register">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus mr-3 w-5 h-5"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" x2="19" y1="8" y2="14"></line><line x1="22" x2="16" y1="11" y2="11"></line></svg>
                <span>Daftar</span>
            </button>
        `;
    }
    // Refresh halaman yang aktif untuk memperbarui data
    const activePage = document.querySelector('.page-content:not(.hidden)');
    if (activePage && activePage.id === 'page-home') renderPhotoGrid(photos);
    if (activePage && activePage.id === 'page-favorites') renderFavorites();
    if (activePage && activePage.id === 'page-history') renderHistory();
    if (activePage && activePage.id === 'page-notifications') renderNotifications();
}

// --- FUNGSI PROFIL (BARU) ---
async function loadProfile() {
    if (!user) return;
    const { data, error } = await supabase.from('profiles').select('*').eq('id', user.id).single();
    if (error) return console.error(error);
    
    document.getElementById('profile-username').innerText = data.username || 'Tanpa Nama';
    document.getElementById('profile-email').innerText = user.email;
    if (data.avatar_url) {
        document.getElementById('profile-avatar').src = data.avatar_url;
    }
    renderProfileGrid();
}

async function handleAvatarUpload(event) {
    if (!user) return showToast('Anda harus login!', 'error');
    const file = event.target.files[0];
    if (!file) return;
    
    const fileExt = file.name.split('.').pop();
    const fileName = `${user.id}.${fileExt}`;
    
    const { error: uploadError } = await supabase.storage.from('avatars').upload(fileName, file, { upsert: true });
    if (uploadError) return showToast(uploadError.message, 'error');

    const { data: { publicUrl } } = supabase.storage.from('avatars').getPublicUrl(fileName);
    const { error: updateError } = await supabase.from('profiles').update({ avatar_url: publicUrl }).eq('id', user.id);
    if (updateError) return showToast(updateError.message, 'error');
    
    document.getElementById('profile-avatar').src = publicUrl;
    showToast('Avatar berhasil diperbarui!', 'success');
}

// --- FUNGSI UPLOAD FOTO (DIMODIFIKASI) ---
async function handleUpload(event) {
    event.preventDefault();
    if (!user) return showToast('Anda harus login!', 'error');

    const title = document.getElementById('upload-title').value.trim();
    const description = document.getElementById('upload-description').value.trim();
    const fileInput = document.getElementById('upload-file');
    const urlInput = document.getElementById('upload-url').value.trim();
    
    let photoUrl = urlInput;

    if (fileInput.files[0]) {
        const file = fileInput.files[0];
        const fileExt = file.name.split('.').pop();
        const fileName = `${user.id}/${Date.now()}.${fileExt}`;
        
        const { error: uploadError } = await supabase.storage.from('photos').upload(fileName, file);
        if (uploadError) return showToast(uploadError.message, 'error');
        
        const { data: { publicUrl } } = supabase.storage.from('photos').getPublicUrl(fileName);
        photoUrl = publicUrl;
    }

    if (!title || !photoUrl) return showToast('Judul dan sumber foto harus diisi!', 'error');

    const { data, error } = await supabase.from('photos').insert({
        title, description, url: photoUrl, user_id: user.id, keywords: ''
    }).select().single();

    if (error) return showToast(error.message, 'error');
    
    photos.unshift(data);
    showToast('Foto berhasil diunggah!', 'success');
    document.getElementById('upload-form').reset();
    renderProfileGrid();
}

// --- FUNGSI LIKE (BARU & DIPERBAIKI) ---
async function toggleLike(photoId) {
    if (!user) return showToast('Anda harus login untuk menyukai foto!', 'error');
    
    // PERBAIKAN: Gunakan .maybeSingle() untuk menghindari error 406
    const { data: existingLike } = await supabase.from('likes').select('*').eq('photo_id', photoId).eq('user_id', user.id).maybeSingle();
    
    if (existingLike) {
        // Unlike
        await supabase.from('likes').delete().eq('id', existingLike.id);
        await supabase.rpc('decrement_likes', { row_id: photoId });
    } else {
        // Like
        await supabase.from('likes').insert({ photo_id: photoId, user_id: user.id });
        await supabase.rpc('increment_likes', { row_id: photoId });
    }
    
    // Muat ulang data untuk memastikan UI sinkron
    await loadPhotosFromServer();
    const photo = photos.find(p => p.id === photoId);
    if(photo) updateLikeButton(photoId, photo);
}

// --- FUNGSI RENDER (DIMODIFIKASI) ---
async function loadPhotosFromServer() {
    try {
        const { data, error } = await supabase.from('photos').select(`*, profiles ( username, avatar_url )`).order('created_at', { ascending: false });
        if (error) throw error;
        photos = data || [];
        renderPhotoGrid(photos);
    } catch (error) {
        console.error('Error loading photos:', error);
        showToast('Gagal memuat data.', 'error');
    }
}

function generatePhotoCard(photo) {
    const isFav = favorites.includes(photo.id);
    const likeCount = photo.likes_count || 0;
    // PERBAIKAN: Placeholder avatar yang lebih andal
    const uploader = photo.profiles || { username: 'Unknown', avatar_url: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'/%3E%3C/svg%3E" };
    
    return `
        <div class="photo-card">
            <div class="relative cursor-pointer" onclick="openPhotoModal(${photo.id})">
                <img src="${photo.url}" alt="${photo.title}" class="w-full h-48 object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 hover:opacity-100 transition-all duration-300 flex items-end p-4">
                    <div class="text-white">
                        <p class="font-semibold">${photo.title}</p>
                        <p class="text-sm opacity-80">${photo.description || 'Tidak ada deskripsi'}</p>
                    </div>
                </div>
            </div>
            <div class="p-4">
                <div class="flex items-center mb-3">
                    <img src="${uploader.avatar_url}" alt="${uploader.username}" class="w-8 h-8 rounded-full mr-2">
                    <span class="text-sm font-medium text-gray-300">${uploader.username}</span>
                </div>
                <div class="flex justify-between items-center">
                    <button class="icon-btn" onclick="event.stopPropagation(); toggleLike(${photo.id})">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"></path></svg>
                        <span class="text-sm">${likeCount}</span>
                    </button>
                    <button class="icon-btn ${isFav ? 'saved' : ''}" onclick="event.stopPropagation(); toggleFavorite(${photo.id})">
                        <svg class="w-6 h-6" fill="${isFav ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    `;
}

function renderPhotoGrid(photoArray, containerId = 'photo-grid') {
    const grid = document.getElementById(containerId);
    if (!grid) return;
    let displayPhotos = [...photoArray];
    const searchTerm = document.getElementById('search-input')?.value.toLowerCase().trim() || '';
    if (searchTerm !== '') {
        displayPhotos = displayPhotos.filter(photo => 
            photo.title.toLowerCase().includes(searchTerm) || 
            (photo.profiles && photo.profiles.username.toLowerCase().includes(searchTerm))
        );
    }
    if (displayPhotos.length === 0) {
        document.getElementById('no-results').classList.remove('hidden');
    } else {
        document.getElementById('no-results')?.classList.add('hidden');
    }
    grid.innerHTML = displayPhotos.map(generatePhotoCard).join('');
}

function renderProfileGrid() {
    if (!user) return;
    const myPhotos = photos.filter(p => p.user_id === user.id);
    const grid = document.getElementById('profile-grid');
    if (myPhotos.length === 0) {
        grid.innerHTML = '<p class="text-center text-gray-500">Kamu belum mengunggah foto apa pun.</p>';
    } else {
        renderPhotoGrid(myPhotos, 'profile-grid');
    }
}

// --- FUNGSI FAVORIT (TETAP, DENGAN LOCAL STORAGE) ---
function toggleFavorite(photoId) {
    const index = favorites.indexOf(photoId);
    const photo = photos.find(p => p.id === photoId);
    if (!photo) return;
    if (index > -1) {
        favorites.splice(index, 1);
        showToast(`"${photo.title}" dihapus dari favorit.`, 'info');
    } else {
        favorites.push(photoId);
        showToast(`"${photo.title}" ditambahkan ke favorit!`, 'success');
    }
    localStorage.setItem('bogelstudio_favorites', JSON.stringify(favorites));
    updateFavoriteButton(photoId);
    if (document.getElementById('page-favorites').classList.contains('active')) renderFavorites();
}
function updateFavoriteButton(photoId) {
    const btn = document.getElementById('modal-favorite-btn');
    if (!btn) return;
    const isFav = favorites.includes(photoId);
    btn.classList.toggle('saved', isFav);
    btn.querySelector('svg').setAttribute('fill', isFav ? 'currentColor' : 'none');
}
function renderFavorites() {
    const grid = document.getElementById('favorite-grid');
    if (!grid) return;
    const favoritePhotos = photos.filter(p => favorites.includes(p.id));
    if (favoritePhotos.length === 0) {
        document.getElementById('favorites-empty').classList.remove('hidden');
        grid.innerHTML = '';
    } else {
        document.getElementById('favorites-empty').classList.add('hidden');
        renderPhotoGrid(favoritePhotos, 'favorite-grid');
    }
}

// --- FUNGSI MODAL (DIMODIFIKASI UNTUK YOUTUBE SHORTS) ---
function openPhotoModal(photoId) {
    const modal = document.getElementById('photo-modal-overlay');
    const photo = photos.find(p => p.id === photoId);
    if (!photo || !modal) return;
    
    // Log history
    logHistory(photo);

    // Populate modal
    document.getElementById('modal-photo-img').src = photo.url;
    document.getElementById('modal-photo-title').textContent = photo.title;
    document.getElementById('modal-photo-description').textContent = photo.description || 'Tidak ada deskripsi';
    
    const uploader = photo.profiles || { username: 'Unknown', avatar_url: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'/%3E%3C/svg%3E" };
    document.getElementById('modal-uploader-avatar').src = uploader.avatar_url;
    document.getElementById('modal-photo-uploader').textContent = uploader.username;
    document.getElementById('modal-photo-date').textContent = new Date(photo.created_at).toLocaleDateString('id-ID');
    
    updateLikeButton(photoId, photo);
    updateFavoriteButton(photoId);
    
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}
function closePhotoModal() {
    const modal = document.getElementById('photo-modal-overlay');
    if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
    }
}
function updateLikeButton(photoId, photo) {
    const btn = document.getElementById('modal-like-btn');
    const countSpan = document.getElementById('modal-like-count');
    if (!btn || !photo) return;
    
    const isLiked = user && photo.likes && photo.likes.some(like => like.user_id === user.id);
    btn.classList.toggle('liked', isLiked);
    countSpan.textContent = photo.likes_count || 0;
}

// --- FUNGSI LAINNYA (HISTORY, NOTIFIKASI, dll) ---
function logHistory(photo) {
    const historyItem = { photoId: photo.id, title: photo.title, timestamp: Date.now() };
    history = history.filter(item => item.photoId !== photo.id);
    history.unshift(historyItem);
    if (history.length > 20) history = history.slice(0, 20);
    localStorage.setItem('bogelstudio_history', JSON.stringify(history));
}
function renderHistory() {
    const list = document.getElementById('history-list');
    if (!list) return;
    if (history.length === 0) {
        document.getElementById('history-empty').classList.remove('hidden');
        list.innerHTML = '';
        return;
    }
    document.getElementById('history-empty').classList.add('hidden');
    list.innerHTML = history.map(item => {
        const photo = photos.find(p => p.id === item.photoId);
        const timeAgo = new Date(item.timestamp).toLocaleString('id-ID');
        if (!photo) return '';
        return `<div class="flex items-center p-4 bg-gray-800 rounded-xl border border-gray-700 hover:bg-gray-700/50 transition cursor-pointer" onclick="openPhotoModal('${photo.id}')"><img src="${photo.url}" alt="${photo.title}" class="w-16 h-16 object-cover rounded-lg flex-shrink-0 mr-4"><div class="flex-grow"><p class="text-white font-semibold">${photo.title}</p><p class="text-xs text-gray-400">Dilihat: ${timeAgo}</p></div></div>`;
    }).join('');
}
function logNotification(message, type = 'info') {
    const newNotif = { id: crypto.randomUUID(), message, type, read: false, timestamp: Date.now() };
    notifications.unshift(newNotif);
    if (notifications.length > 20) notifications = notifications.slice(0, 20);
    localStorage.setItem('bogelstudio_notifications', JSON.stringify(notifications));
    updateNotifBadge();
}
function updateNotifBadge() {
    const badge = document.getElementById('notif-badge');
    const unreadCount = notifications.filter(n => !n.read).length;
    if (badge) {
        if (unreadCount > 0) { badge.textContent = unreadCount; badge.classList.remove('hidden'); }
        else { badge.classList.add('hidden'); }
    }
}
function renderNotifications() {
    const list = document.getElementById('notifications-list');
    if (!list) return;
    if (notifications.length === 0) { list.innerHTML = '<p class="text-gray-500">Tidak ada notifikasi baru.</p>'; return; }
    list.innerHTML = notifications.map(n => {
        const bgColor = n.type === 'success' ? 'bg-green-900/30 border-green-700' : n.type === 'error' ? 'bg-red-900/30 border-red-700' : 'bg-gray-800 border-gray-700';
        const readClass = n.read ? 'opacity-60' : 'font-medium';
        const timeAgo = new Date(n.timestamp).toLocaleString('id-ID');
        return `<div class="p-4 rounded-xl border ${bgColor} ${readClass}"><p class="text-sm">${n.message}</p><p class="text-xs text-gray-500 mt-1">${timeAgo}</p></div>`;
    }).join('');
    notifications = notifications.map(n => ({ ...n, read: true }));
    localStorage.setItem('bogelstudio_notifications', JSON.stringify(notifications));
    updateNotifBadge();
}
function clearNotifications() {
    customConfirm('Hapus Notifikasi', 'Apakah Anda yakin ingin menghapus semua notifikasi?')
    .then((confirmed) => { if (confirmed) { notifications = []; localStorage.setItem('bogelstudio_notifications', JSON.stringify(notifications)); renderNotifications(); showToast('Semua notifikasi telah dihapus.', 'success'); } });
}
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    if (!container) return;
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => { toast.classList.remove('show'); setTimeout(() => container.removeChild(toast), 300); }, 4000);
}
function customConfirm(title, message) {
    return new Promise((resolve) => {
        const overlay = document.getElementById('custom-confirm-overlay');
        const titleEl = document.getElementById('confirm-title');
        const messageEl = document.getElementById('confirm-message');
        const btnYes = document.getElementById('confirm-yes');
        const btnNo = document.getElementById('confirm-no');
        if (!overlay || !titleEl || !messageEl || !btnYes || !btnNo) return resolve(false);
        titleEl.textContent = title; messageEl.textContent = message;
        overlay.style.display = 'flex'; setTimeout(() => overlay.classList.add('show'), 10);
        const cleanup = (result) => { overlay.classList.remove('show'); setTimeout(() => overlay.style.display = 'none', 300); btnYes.onclick = null; btnNo.onclick = null; resolve(result); };
        btnYes.onclick = () => cleanup(true); btnNo.onclick = () => cleanup(false);
    });
}
function changePage(pageId) {
    const pages = document.querySelectorAll('.page-content');
    const navButtons = document.querySelectorAll('.nav-button');
    pages.forEach(page => { page.classList.add('hidden'); });
    navButtons.forEach(btn => { btn.classList.remove('active-nav-link'); });

    const pageElement = document.getElementById(`page-${pageId}`);
    if (pageElement) {
        pageElement.classList.remove('hidden');
        const activeBtn = document.querySelector(`.nav-button[data-page="${pageId}"]`);
        if (activeBtn) activeBtn.classList.add('active-nav-link');
    }

    if (pageId === 'home') renderPhotoGrid(photos);
    if (pageId === 'history') renderHistory();
    if (pageId === 'favorites') renderFavorites();
    if (pageId === 'notifications') renderNotifications();
    if (pageId === 'profile') loadProfile();
    
    if (window.innerWidth < 768) closeSidebar();
}
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    if (sidebar && overlay) {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
    }
}
function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    if (sidebar && overlay) {
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
    }
}
function handleSearch(term) {
    renderPhotoGrid(photos);
}

// --- INISIALISASI ---
document.addEventListener('DOMContentLoaded', async () => {
    const config = await getConfig();
    const { createClient } = window.supabase;
    supabase = createClient(config.SUPABASE_URL, config.SUPABASE_ANON_KEY);

    const { data: { session } } = await supabase.auth.getSession();
    user = session?.user || null;
    updateUIForAuthStatus();

    document.getElementById('register-form')?.addEventListener('submit', (e) => { e.preventDefault(); signUp(); });
    document.getElementById('login-form')?.addEventListener('submit', (e) => { e.preventDefault(); signIn(); });
    document.getElementById('upload-form')?.addEventListener('submit', handleUpload);
    document.getElementById('avatar-upload')?.addEventListener('change', handleAvatarUpload);
    
    loadPhotosFromServer();
    changePage('home');
});
    </script>
</body>
</html>